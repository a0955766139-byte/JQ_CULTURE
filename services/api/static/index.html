<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å–¬éˆå¿ƒå­¸ Â· æ•¸å­—å¿ƒç†å­¸ Home</title>
  <!-- iPhone åŠ åˆ°ä¸»ç•«é¢çš„åœ–ç¤º -->
  <link rel="apple-touch-icon" sizes="180x180" href="/static/jq-icon-512.png" />

  <!-- ä¸€èˆ¬ç€è¦½å™¨çš„å° iconï¼ˆéå¿…è¦ï¼Œä½†é †ä¾¿åŠ ï¼‰ -->
  <link rel="icon" type="image/png" sizes="32x32" href="/static/jq-icon-512.png" />
</head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    /* æ‰‹æ©Ÿå„ªå…ˆç°¡å–®ç‰ˆå‹ */
    :root {
      --bg: #f6f4f0;
      --card: #ffffff;
      --primary: #333333;
      --sub: #777777;
      --accent: #d4a373;
      --radius-lg: 18px;
    }
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", system-ui, sans-serif;
      background: var(--bg);
      color: var(--primary);
    }
    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 16px 16px 32px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    header {
      padding: 12px 16px 10px;
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, #fdfcfb, #e2d9c8);
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }
    header h1 {
      font-size: 20px;
      margin: 0 0 4px;
    }
    header p {
      margin: 0;
      font-size: 13px;
      color: var(--sub);
    }
    .today {
      padding: 12px 14px;
      border-radius: var(--radius-lg);
      background: var(--card);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      font-size: 14px;
      line-height: 1.5;
    }
    .today-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--sub);
      margin-bottom: 4px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .tile {
      border: none;
      border-radius: var(--radius-lg);
      padding: 12px 10px;
      background: var(--card);
      text-align: left;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }
    .tile:active {
      transform: scale(0.97);
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .tile-top {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }
    .emoji {
      font-size: 20px;
    }
    .tile-title {
      font-size: 15px;
      font-weight: 600;
    }
    .tile-sub {
      font-size: 12px;
      color: var(--sub);
    }
    footer {
      margin-top: auto;
      text-align: center;
      font-size: 11px;
      color: var(--sub);
      opacity: 0.8;
      padding-top: 8px;
    }
    .small {
      font-size: 11px;
      color: var(--sub);
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>å–¬éˆå¿ƒå­¸ Â· æ•¸å­—å¿ƒç†å­¸</h1>
      <p id="home-greeting">è¼‰å…¥ä¸­â‹¯</p>
    </header>

    <section class="today">
      <div class="today-title">ä»Šæ—¥æé†’</div>
      <div id="home-today">ç­‰å¾…å¾ /api/v1/home è¼‰å…¥è³‡æ–™â‹¯</div>
    </section>

    <section class="grid" id="home-grid">
      <!-- 1. æ¯æ—¥æŠ½ç‰Œ -->
      <button class="tile" data-id="cards">
        <div class="tile-top">
          <span class="emoji">ğŸƒ</span>
          <span class="tile-title">æ¯æ—¥æŠ½ç‰Œ</span>
        </div>
        <div class="tile-sub">ç”¨ä¸€å¼µç‰Œçœ‹è¦‹ç•¶ä¸‹è¨Šæ¯</div>
      </button>

      <!-- 2. æ•¸å­—å¿ƒç†å­¸æ¸¬è©• -->
      <button class="tile" data-id="calc">
        <div class="tile-top">
          <span class="emoji">ğŸ”¢</span>
          <span class="tile-title">æ•¸å­—å¿ƒç†å­¸</span>
        </div>
        <div class="tile-sub">ç”Ÿå‘½éˆæ•¸ Ã— ç¾ä»£æ•¸å­—å¿ƒç†å­¸</div>
      </button>

      <!-- 3. é¡¯åŒ–æ—¥è¨˜ / å­¸å“¡æ—¥è¨˜ -->
      <button class="tile" data-id="journal">
        <div class="tile-top">
          <span class="emoji">ğŸ““</span>
          <span class="tile-title">é¡¯åŒ–æ—¥è¨˜</span>
        </div>
        <div class="tile-sub">å¯«ä¸‹ä»Šå¤©çš„è¦ºå¯Ÿèˆ‡é¡¯åŒ–</div>
      </button>

      <!-- 4. å€‹æ¡ˆè§£æï¼†èª²ç¨‹ -->
      <button class="tile" data-id="courses">
        <div class="tile-top">
          <span class="emoji">ğŸ§</span>
          <span class="tile-title">å€‹æ¡ˆ & èª²ç¨‹</span>
        </div>
        <div class="tile-sub">ä¸€å°ä¸€è§£æèˆ‡é€²éšèª²ç¨‹</div>
      </button>

      <!-- 5. å•†åŸ -->
      <button class="tile" data-id="store">
        <div class="tile-top">
          <span class="emoji">ğŸ›’</span>
          <span class="tile-title">å•†åŸ</span>
        </div>
        <div class="tile-sub">æ›¸ç±ã€èª²ç¨‹ã€æ•¸å­—å·¥å…·</div>
      </button>

      <!-- 6. æœƒå“¡ä¸­å¿ƒ -->
      <button class="tile" data-id="me">
        <div class="tile-top">
          <span class="emoji">ğŸ‘¤</span>
          <span class="tile-title">æœƒå“¡ä¸­å¿ƒ</span>
        </div>
        <div class="tile-sub">å€‹äººè³‡æ–™ & è¨­å®š</div>
      </button>
    </section>

    <div class="small">
      å°æç¤ºï¼šåœ¨æ‰‹æ©Ÿç€è¦½å™¨ç”¨ã€ŒåŠ åˆ°ä¸»ç•«é¢ã€ï¼Œå°±å¯ä»¥åƒ App ä¸€æ¨£å•Ÿå‹•é€™å€‹é¦–é  âœ¨
    </div>

    <footer>
      JQ Culture Numerology Â· demo v0.2.0
    </footer>
  </div>

  <script>
    // é€™è£¡é æœŸ /api/v1/home å›å‚³é¡ä¼¼ï¼š
    // { "user_block": "xxx", "sections": [ {id, title, subtitle, link}, ... ] }

    async function loadHome() {
      const greetingEl = document.getElementById('home-greeting');
      const todayEl = document.getElementById('home-today');

      try {
        const res = await fetch('/api/v1/home');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();

        // é¡¯ç¤ºä½¿ç”¨è€…å•å€™å€å¡Š
        if (data.user_block) {
          greetingEl.textContent = data.user_block;
        } else {
          greetingEl.textContent = 'æ­¡è¿å›åˆ°å–¬éˆå¿ƒå­¸ Â· ç·´ç¿’è¦ºå¯Ÿèˆ‡é¡¯åŒ–çš„æ—¥å¸¸ã€‚';
        }

        // ä»Šæ—¥æé†’ï¼šå¦‚æœå¾Œç«¯æœ‰ today_text / messageï¼Œå°±ç”¨ï¼›ä¸ç„¶é¡¯ç¤º JSON æ‘˜è¦
        if (data.today_text) {
          todayEl.textContent = data.today_text;
        } else if (data.message) {
          todayEl.textContent = data.message;
        } else {
          todayEl.textContent = 'API å·²é€£ç·šæˆåŠŸï¼Œå¯ä»¥é–‹å§‹ä½¿ç”¨å…­å¤§ä¸»åŠŸèƒ½ã€‚';
        }

        // å¦‚æœæœ‰ sectionsï¼Œå°±å¥—åˆ°å…­å€‹ tile ä¸Š
        if (Array.isArray(data.sections)) {
          data.sections.forEach(section => {
            const tile = document.querySelector('.tile[data-id="' + section.id + '"]');
            if (!tile) return;
            const titleEl = tile.querySelector('.tile-title');
            const subEl = tile.querySelector('.tile-sub');
            if (section.title) titleEl.textContent = section.title;
            if (section.subtitle) subEl.textContent = section.subtitle;
            if (section.link) tile.dataset.link = section.link;
          });
        }
      } catch (err) {
        console.error(err);
        greetingEl.textContent = 'é€£ç·š /api/v1/home å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
        todayEl.textContent = 'éŒ¯èª¤è¨Šæ¯ï¼š' + err.message;
      }
    }

    // tile é»æ“Šè¡Œç‚ºï¼šå…ˆç”¨ç°¡å–® alertï¼›ä¹‹å¾Œå¯ä»¥æ”¹æˆè·³é 
    function bindTileClicks() {
      const tiles = document.querySelectorAll('.tile');
      tiles.forEach(tile => {
        tile.addEventListener('click', () => {
          const id = tile.dataset.id;
          const link = tile.dataset.link;

          if (link) {
            // ä¹‹å¾Œä½ å¯ä»¥è®“ link æŒ‡å‘çœŸæ­£çš„å‰ç«¯è·¯ç”±æˆ–å¤–éƒ¨ç¶²å€
            window.location.href = link;
            return;
          }

          // å…ˆç”¨ alert ç•¶å ä½ï¼Œç­‰ä½ æœ‰å‰ç«¯é é¢å†èª¿æ•´
          const mapping = {
            cards: 'ğŸƒ æ¯æ—¥æŠ½ç‰Œï¼šä¹‹å¾Œæœƒé€£åˆ°æŠ½ç‰Œé ï¼Œå‘¼å« /api/v1/cards/randomã€‚',
            calc: 'ğŸ”¢ æ•¸å­—å¿ƒç†å­¸ï¼šä¹‹å¾Œæœƒé€£åˆ°æ¸¬è©•é ï¼Œå‘¼å« /api/v1/calcã€‚',
            journal: 'ğŸ““ é¡¯åŒ–æ—¥è¨˜ï¼šä¹‹å¾Œæœƒé€£åˆ°æ—¥è¨˜é ï¼Œå‘¼å« /api/v1/me/journalã€‚',
            courses: 'ğŸ§ å€‹æ¡ˆ & èª²ç¨‹ï¼šä¹‹å¾Œæœƒæ”¾èª²ç¨‹ä»‹ç´¹èˆ‡é ç´„é€£çµã€‚',
            store: 'ğŸ›’ å•†åŸï¼šä¹‹å¾Œæœƒæ”¾ä½ çš„æ›¸ã€èª²ç¨‹ã€å·¥å…·å•†å“é€£çµã€‚',
            me: 'ğŸ‘¤ æœƒå“¡ä¸­å¿ƒï¼šä¹‹å¾Œæœƒé¡¯ç¤ºå€‹äººè³‡æ–™ã€ç™»å…¥ç‹€æ…‹ç­‰ã€‚'
          };
          alert(mapping[id] || 'é€™å€‹åŠŸèƒ½é‚„åœ¨é–‹ç™¼ä¸­ âœ¨');
        });
      });
    }

    loadHome();
    bindTileClicks();
  </script>
</body>
</html>
